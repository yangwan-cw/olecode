name: å‘å¸ƒ vue_3_dev

on:
  push:
    branches: [ "master" ]  # è§¦å‘æ¡ä»¶ï¼šæŽ¨é€åˆ° master åˆ†æ”¯

jobs:
  publish_dev_code:
    runs-on: ubuntu-latest
    # needs: back_java  # ç¡®ä¿åœ¨å¤‡ä»½ä»£ç ä½œä¸šæˆåŠŸåŽæ‰æ‰§è¡Œ
    steps:
      - name: æ‰“å°ä¿¡æ¯ ðŸŽ‰
        run: echo "ðŸŽ‰ The job was automatically triggered by a ${{ github.event_name }} event."

      - name: æ‰“å°æ“ä½œç³»ç»Ÿä¿¡æ¯ ðŸ§
        run: echo "ðŸ§ This job is now running on a ${{ runner.os }} server hosted by GitHub!"

      - name: æ‰“å°åˆ†æ”¯å’Œä»“åº“ä¿¡æ¯ ðŸ”Ž
        run: echo "ðŸ”Ž The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."

      - name: æ£€æŸ¥ä»“åº“ä»£ç  ðŸ‘ï¸Ž
        uses: actions/checkout@v4

      - name: æ‰“å°ä»“åº“æ–‡ä»¶åˆ—è¡¨ ðŸ“¦
        run: ls ${{ github.workspace }}

      - name: æŸ¥çœ‹ zip æ–‡ä»¶ ðŸ“¦
        run: ls

      - name: æ‰“åŒ… vue3
      - name: Use Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "18.16.0"  # æŒ‡å®š Node ç‰ˆæœ¬
        - run: npm install
        - run: npm run build
      - name: åˆ é™¤ä¹‹å‰çš„æ–‡ä»¶
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
        env:
          LASTSSH: "Doing something after copying"
        with:
          host: ${{ secrets.SERVER_PORT }}
          user: ${{ secrets.USERNAME }}
          pass: ${{ secrets.PASSWORD }}
          last_ssh: |
            cd /opt/app/1panel/1panel/apps/openresty/openresty/www/sites/vue3.site/index/dist
            rm -rf *   # åˆ é™¤ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•

      - name: æŽ¨é€åˆ°æµ‹è¯•æœåŠ¡å™¨å¤‡ä»½ zip æ–‡ä»¶å¤¹
        uses: cross-the-world/ssh-scp-ssh-pipelines@latest
        env:
          LASTSSH: "Doing something after copying"
        with:
          host: ${{ secrets.DEV_SERVER_HOST }}
          user: ${{ secrets.DEV_SERVER_USER }}
          pass: ${{ secrets.DEV_SERVER_PASSWORD }}
          scp: |
            dist => /opt/app/1panel/1panel/apps/openresty/openresty/www/sites/vue3.site/index/dist
          last_ssh: |
            ls
